---
- name: Install and Configure Logstash on Rocky Linux
  hosts: logstash_server
  become: yes

  tasks:
    - name: Install required dependencies
      yum:
        name:
          - epel-release
          - java-11-openjdk
          - java-11-openjdk-devel
        state: present

    - name: Import Elastic GPG Key
      rpm_key:
        key: https://artifacts.elastic.co/GPG-KEY-elasticsearch
        state: present

    - name: Add Elastic 7.x YUM Repository
      yum_repository:
        name: elastic-7.x
        description: Elastic repository for 7.x packages
        baseurl: https://artifacts.elastic.co/packages/7.x/yum
        gpgcheck: yes
        gpgkey: https://artifacts.elastic.co/GPG-KEY-elasticsearch
        enabled: yes

    - name: Install Logstash
      yum:
        name: logstash
        state: present

    - name: Enable and Start Logstash Service
      systemd:
        name: logstash
        enabled: yes
        state: started

    - name: Open Logstash Port in Firewalld (5044)
      firewalld:
        port: 5044/tcp
        permanent: yes
        state: enabled
        immediate: yes

    - name: Set SELinux to Permissive Mode
      selinux:
        policy: targeted
        state: permissive
