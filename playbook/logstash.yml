---
- name: Install and Configure Logstash on Rocky Linux
  hosts: logstash_server
  become: yes

  tasks:
    - name: Install required dependencies
      yum:
        name:
          - epel-release
          - java-11-openjdk
          - java-11-openjdk-devel
          - wget
        state: present

    - name: Download Logstash RPM Package
      get_url:
        url: "https://artifacts.elastic.co/downloads/logstash/logstash-7.17.0-x86_64.rpm"
        dest: "/tmp/logstash-7.17.0-x86_64.rpm"

    - name: Install Logstash from RPM Package
      command: "rpm -ivh /tmp/logstash-7.17.0-x86_64.rpm"
      args:
        creates: "/usr/share/logstash"

    - name: Enable and Start Logstash Service
      systemd:
        name: logstash
        enabled: yes
        state: started

    - name: Open Logstash Port in Firewalld (5044)
      firewalld:
        port: 5044/tcp
        permanent: yes
        state: enabled
        immediate: yes

    - name: Set SELinux to Permissive Mode
      selinux:
        policy: targeted
        state: permissive
